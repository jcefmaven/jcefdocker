ARG version=ltsc2019
FROM mcr.microsoft.com/dotnet/framework/runtime:4.8-20211012-windowsservercore-$version

ENV chocolateyUseWindowsCompression false

RUN powershell -Command \
    iex ((new-object net.webclient).DownloadString('https://chocolatey.org/install.ps1')); \
    choco feature disable --name showDownloadProgress

RUN choco config set cachelocation C:\chococache

COPY util/temurin11.nupkg C:/
RUN choco install temurin11.nupkg --params="/both /ADDLOCAL=FeatureMain,FeatureEnvironment,FeatureJarFileRunWith,FeatureJavaHome /INSTALLDIR=C:\Program Files\Temurin\ /quiet" --confirm --limit-output --timeout 216000 && rmdir /S /Q C:\chococache
RUN choco install cmake.install --version=3.13.1 --installargs '"ADD_CMAKE_TO_PATH=System"' --confirm --limit-output --timeout 216000 && rmdir /S /Q C:\chococache
RUN choco install ninja --confirm --limit-output --timeout 216000 && rmdir /S /Q C:\chococache
RUN choco install git --confirm --limit-output --timeout 216000 && rmdir /S /Q C:\chococache
RUN choco install python --version=3.7.2 --confirm --limit-output --timeout 216000 && rmdir /S /Q C:\chococache
RUN choco install visualstudio2019buildtools --package-parameters "--add Microsoft.VisualStudio.Workload.VCTools --add Microsoft.VisualStudio.Component.VC.ATL --includeRecommended" --confirm --limit-output --timeout 216000 && rmdir /S /Q C:\chococache
