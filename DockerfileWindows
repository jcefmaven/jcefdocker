ARG version=ltsc2019
FROM mcr.microsoft.com/dotnet/framework/runtime:4.8-20211012-windowsservercore-$version

ENV chocolateyUseWindowsCompression false

RUN powershell -Command \
    iex ((new-object net.webclient).DownloadString('https://chocolatey.org/install.ps1')); \
    choco feature disable --name showDownloadProgress

RUN choco config set cachelocation C:\chococache

RUN mkdir C:\arm64jdk
RUN curl -o C:\arm64jdk\jdk_arm64.zip https://aka.ms/download-jdk/microsoft-jdk-11-windows-aarch64.zip
RUN compact /u "C:\arm64jdk\jdk_arm64.zip" /i /Q
RUN del /f C:\arm64jdk\jdk_arm64.zip
RUN choco install jdk8 -params "both=true" --confirm --limit-output --timeout 216000 && rmdir /S /Q C:\chococache
RUN choco install cmake.install --version=3.13.1 --installargs '"ADD_CMAKE_TO_PATH=System"' --confirm --limit-output --timeout 216000 && rmdir /S /Q C:\chococache
RUN choco install ninja --confirm --limit-output --timeout 216000 && rmdir /S /Q C:\chococache
RUN choco install git --confirm --limit-output --timeout 216000 && rmdir /S /Q C:\chococache
RUN choco install python --version=3.7.2 --confirm --limit-output --timeout 216000 && rmdir /S /Q C:\chococache
RUN choco install visualstudio2019buildtools --package-parameters "--add Microsoft.VisualStudio.Workload.VCTools --add Microsoft.VisualStudio.Component.VC.ATL --add Microsoft.VisualStudio.Component.VC.Tools.ARM64 --includeRecommended" --confirm --limit-output --timeout 216000 && rmdir /S /Q C:\chococache

