ARG version=ltsc2019
FROM mcr.microsoft.com/windows/servercore:$version

ENV chocolateyUseWindowsCompression false

RUN powershell -Command \
    iex ((new-object net.webclient).DownloadString('https://chocolatey.org/install.ps1')); \
    choco feature disable --name showDownloadProgress

RUN choco config set cachelocation C:\chococache

RUN choco install cmake.install --version=3.13.1 --confirm --limit-output --timeout 216000 && rmdir /S /Q C:\chococache
RUN choco install git --confirm --limit-output --timeout 216000 && rmdir /S /Q C:\chococache
RUN choco install openjdk11 --confirm --limit-output --timeout 216000 && rmdir /S /Q C:\chococache
RUN choco install python --version=3.7.2 --confirm --limit-output --timeout 216000 && rmdir /S /Q C:\chococache
RUN choco install visualstudio2019buildtools --confirm --limit-output --timeout 216000 && rmdir /S /Q C:\chococache
RUN choco install visualstudio2019-workload-vctools --package-parameters "--includeRecommended" --confirm --limit-output --timeout 216000 && rmdir /S /Q C:\chococache

#Step x: Setup entrypoint
COPY entrypoint_windows.bat /entrypoint_windows.bat
ENTRYPOINT ["/entrypoint_windows.bat"]

